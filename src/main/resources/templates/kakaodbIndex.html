<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ê´€ê´‘ ëª…ì†Œ ì°¾ê¸° (Kakao Map Demo)</title>
    <!-- Kakao Maps JS SDK: ì•± í‚¤ë¥¼ ì•„ë˜ YOUR_APP_KEY_HERE ë¡œ êµì²´í•˜ì„¸ìš” -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=a495c5944000f839243cd8711eb3591b&autoload=false&libraries=services,clusterer"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: Pretendard, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans KR", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
        header { padding: 14px 18px; border-bottom: 1px solid #eee; display:flex; gap:12px; align-items:center; }
        header h1 { font-size: 18px; margin: 0 8px 0 0; }
        header .hint { color:#666; font-size: 13px; }
        .container { display: grid; grid-template-columns: 380px 1fr; height: calc(100vh - 60px); }
        .left { border-right: 1px solid #eee; padding: 12px; overflow: auto; }
        .left h2 { margin: 6px 0 10px; font-size: 16px; }
        .search-row { display:flex; gap:8px; }
        input[type="text"] { flex: 1; padding: 10px 12px; border:1px solid #ddd; border-radius:10px; }
        button { padding: 10px 14px; border:1px solid #ddd; background:#fafafa; border-radius:10px; cursor:pointer; }
        button.primary { background:white; border-color:#222; }
        .results { margin-top: 12px; display: grid; gap:8px; }
        .card { border:1px solid #eee; border-radius:12px; padding:10px; }
        .card h3 { margin: 0 0 6px; font-size: 15px; }
        .card p { margin: 2px 0; color:#555; font-size: 13px; }
        .pagination { display:flex; gap:6px; margin-top:8px; flex-wrap: wrap; }
        .pagination button { padding:6px 10px; border-radius: 8px; }
        .pill { display:inline-block; border:1px solid #eee; padding:4px 8px; border-radius:999px; font-size:12px; color:#666; }
        .map { position: relative; }
        #map { width: 100%; height: 100%; min-height: 420px; }
        .floating { position:absolute; top:10px; right:10px; background:white; border:1px solid #eee; border-radius:12px; padding:10px; display:flex; gap:8px; }
        .legend { position:absolute; bottom:10px; left:10px; background:white; border:1px solid #eee; border-radius:12px; padding:8px 10px; color:#555; font-size: 12px; }
        .muted { color:#777; font-size:12px; }
        .hr { height:1px; background:#f1f1f1; margin:8px 0; }
        .small { font-size: 12px; }
        .footer { padding:8px 12px; border-top:1px solid #eee; color:#666; font-size: 12px; }
    </style>
</head>
<body>
<header>
    <h1>ê´€ê´‘ ëª…ì†Œ ì°¾ê¸°</h1>
    <span class="hint">Kakao Maps JS SDK + Places ì„œë¹„ìŠ¤ ë°ëª¨</span>
</header>
<div class="container">
    <aside class="left">
        <h2>ê²€ìƒ‰</h2>
        <div class="search-row">
            <input id="keyword" type="text" placeholder="ì˜ˆ) ê²½ë³µê¶, ì œì£¼ë„ ì¹´í˜, ìˆ˜ì› í™”ì„±" />
            <button class="primary" id="searchBtn">ê²€ìƒ‰</button>
        </div>
        <div style="margin-top:8px" class="small muted">TIP: í‚¤ì›Œë“œ ê²€ìƒ‰ì€ ì¹´ì¹´ì˜¤ ì¥ì†Œ(Places) APIë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ìƒì„¸ ì •ë³´ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>
        <div class="hr"></div>
        <div class="results" id="results"></div>
        <div class="pagination" id="pagination"></div>
        <div class="hr"></div>
        <h2>ì£¼ë³€ ê´€ê´‘ì§€ (ì¹´í…Œê³ ë¦¬: ê´€ê´‘ëª…ì†Œ)</h2>
        <div class="small muted">ì§€ë„ì˜ ì¤‘ì‹¬ ì£¼ë³€ì„ ê¸°ì¤€ìœ¼ë¡œ ê´€ê´‘ëª…ì†Œ(AT4)ë¥¼ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
        <div style="display:flex; gap:8px; margin-top:8px">
            <button id="nearbyBtn">í˜„ì¬ ì¤‘ì‹¬ì—ì„œ ì°¾ê¸°</button>
            <span class="pill" id="centerCoords"></span>
        </div>
        <div class="results" id="nearby"></div>
    </aside>
    <main class="map">
        <div id="map"></div>
        <div class="floating">
            <button id="moveSeoul">ì„œìš¸</button>
            <button id="moveBusan">ë¶€ì‚°</button>
            <button id="moveJeju">ì œì£¼</button>
        </div>
        <div class="legend">
            <div><strong>ë²”ë¡€</strong></div>
            <div>ğŸ”µ ê²€ìƒ‰ ê²°ê³¼ / ğŸŸ¢ ì£¼ë³€ ê´€ê´‘ëª…ì†Œ</div>
        </div>
    </main>
</div>
<div class="footer">
    ë°ëª¨ ëª©ì ì˜ í´ë¼ì´ì–¸íŠ¸ ì „ìš© ì½”ë“œì…ë‹ˆë‹¤. ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë¹„ë°€í‚¤(REST API)ëŠ” ì ˆëŒ€ ë¸Œë¼ìš°ì €ì— ë…¸ì¶œí•˜ì§€ ë§ˆì„¸ìš”.
</div>

<script>
    // Kakao ë§µ ë¡œë”
    kakao.maps.load(function() {
        const mapContainer = document.getElementById('map');
        const mapOption = { center: new kakao.maps.LatLng(37.5665, 126.9780), level: 6 };
        const map = new kakao.maps.Map(mapContainer, mapOption);
        const clusterer = new kakao.maps.MarkerClusterer({ map: map, averageCenter: true, minLevel: 7 });
        const places = new kakao.maps.services.Places();
        const infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });
        const $results = document.getElementById('results');
        const $pagination = document.getElementById('pagination');
        const $nearby = document.getElementById('nearby');
        const $centerCoords = document.getElementById('centerCoords');

        let searchMarkers = [];
        let nearbyMarkers = [];

        function setCenterLabel() {
            const c = map.getCenter();
            $centerCoords.textContent = `center: ${c.getLat().toFixed(5)}, ${c.getLng().toFixed(5)}`;
        }
        setCenterLabel();
        kakao.maps.event.addListener(map, 'center_changed', setCenterLabel);

        function clearMarkers(markers) {
            markers.forEach(m => m.setMap(null));
            markers.length = 0;
        }
        function renderList($el, items, colorEmoji) {
            $el.innerHTML = '';
            items.forEach((p, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
            <h3>${idx+1}. ${p.place_name}</h3>
            <p>${p.road_address_name || p.address_name || ''}</p>
            <p class="small muted">ì „í™”: ${p.phone || '-'}</p>
            <div class="small muted">ì¢Œí‘œ: ${p.y}, ${p.x} ${colorEmoji}</div>
          `;
                card.onclick = () => {
                    const pos = new kakao.maps.LatLng(p.y, p.x);
                    map.panTo(pos);
                };
                $el.appendChild(card);
            });
        }

        // ê²€ìƒ‰ (í‚¤ì›Œë“œ)
        function searchKeyword() {
            const kw = document.getElementById('keyword').value.trim();
            if (!kw) { alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”'); return; }
            infowindow.close();
            clearMarkers(searchMarkers);
            places.keywordSearch(kw, function(data, status, pagination) {
                if (status !== kakao.maps.services.Status.OK) {
                    alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    $results.innerHTML = ''; $pagination.innerHTML='';
                    return;
                }
                const bounds = new kakao.maps.LatLngBounds();
                data.forEach(p => {
                    const pos = new kakao.maps.LatLng(p.y, p.x);
                    bounds.extend(pos);
                    const marker = new kakao.maps.Marker({ position: pos });
                    searchMarkers.push(marker);
                    kakao.maps.event.addListener(marker, 'click', function() {
                        const html = `
                <div style="padding:8px 10px">
                  <div style="font-weight:600;margin-bottom:4px">${p.place_name}</div>
                  <div style="font-size:12px;color:#555">${p.road_address_name || p.address_name || ''}</div>
                  <div style="font-size:12px;color:#666">ì „í™”: ${p.phone || '-'}</div>
                  <a href="${p.place_url}" target="_blank" style="font-size:12px">ìƒì„¸ë³´ê¸°</a>
                </div>`;
                        infowindow.setContent(html);
                        infowindow.open(map, marker);
                    });
                });
                clusterer.clear();
                clusterer.addMarkers(searchMarkers);
                map.setBounds(bounds);
                renderList($results, data, 'ğŸ”µ');
                renderPagination(pagination);
            }, { useMapBounds: false });
        }

        function renderPagination(pagination) {
            $pagination.innerHTML = '';
            for (let i = 1; i <= pagination.last; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                if (i === pagination.current) btn.disabled = true;
                btn.onclick = () => pagination.gotoPage(i);
                $pagination.appendChild(btn);
            }
        }

        // ì£¼ë³€ ê´€ê´‘ì§€ (ì¹´í…Œê³ ë¦¬ ê²€ìƒ‰: AT4 = ê´€ê´‘ëª…ì†Œ)
        function searchNearbyAttractions() {
            infowindow.close();
            clearMarkers(nearbyMarkers);
            const center = map.getCenter();
            const options = { location: center, radius: 5000 };
            places.categorySearch('AT4', function(data, status) {
                if (status !== kakao.maps.services.Status.OK) {
                    alert('ì£¼ë³€ ê´€ê´‘ëª…ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.');
                    $nearby.innerHTML = '';
                    return;
                }
                data.forEach(p => {
                    const pos = new kakao.maps.LatLng(p.y, p.x);
                    const marker = new kakao.maps.Marker({ position: pos, image: new kakao.maps.MarkerImage(
                            'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png',
                            new kakao.maps.Size(24, 35)) });
                    marker.setMap(map);
                    nearbyMarkers.push(marker);
                    kakao.maps.event.addListener(marker, 'click', function() {
                        const html = `
                <div style="padding:8px 10px">
                  <div style="font-weight:600;margin-bottom:4px">[ê´€ê´‘ëª…ì†Œ] ${p.place_name}</div>
                  <div style="font-size:12px;color:#555">${p.road_address_name || p.address_name || ''}</div>
                  <a href="${p.place_url}" target="_blank" style="font-size:12px">ìƒì„¸ë³´ê¸°</a>
                </div>`;
                        infowindow.setContent(html);
                        infowindow.open(map, marker);
                    });
                });
                renderList($nearby, data, 'ğŸŸ¢');
            }, options);
        }

        // ì´ë™ ë²„íŠ¼
        document.getElementById('moveSeoul').onclick = () => map.panTo(new kakao.maps.LatLng(37.5665, 126.9780));
        document.getElementById('moveBusan').onclick = () => map.panTo(new kakao.maps.LatLng(35.1796, 129.0756));
        document.getElementById('moveJeju').onclick = () => map.panTo(new kakao.maps.LatLng(33.4996, 126.5312));

        // ì´ë²¤íŠ¸ ë°”ì¸ë”©
        document.getElementById('searchBtn').onclick = searchKeyword;
        document.getElementById('nearbyBtn').onclick = searchNearbyAttractions;
    });
</script>
</body>
</html>
